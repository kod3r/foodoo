<div class="text-center" id="sort-by">
  <a class="btn btn-large" style="margin-top: 5px;">SORT</a>
  <a class="btn btn-large btn-info" href="#dist" style="margin-top: 5px;">Distance</a>
  <a class="btn btn-large btn-info" href="#last" style="margin-top: 5px;">Last Visit</a>
  <a class="btn btn-large btn-info" href="#name" style="margin-top: 5px;">Name</a>
  <a class="btn btn-large btn-info" href="#hood" style="margin-top: 5px;">Neighborhood</a>
  <a class="btn btn-large btn-warning" id="score_button" href="#score" style="margin-top: 5px;">Score</a>
</div>
<br>
<div class="text-center" id="filters">
  <a class="btn btn-large">FILTER</a>
  <a class="btn btn-large btn-info filter-click" href="#" data-filter="*">All</a>
  <a class="btn btn-large btn-info filter-click" href="#" data-filter=".favorite">Favorite</a>
  <a class="btn btn-large btn-info" href="#" data-filter=".cuisine" id="cuisine-button">
    <div class="cuisine-input" id="cuisine-show">Cuisine</div>
    <div class="cuisine-input input-group" style="display: none" id="cuisine-filter">
      <input type="text" class="form-control" style="max-width: 100px; text-align: center;" id="cuisine-input">
      <span class="input-group-btn">
        <button class="btn btn-default filter-click" type="button" id="cuisine-submit">Select</button>
      </span>
    </div>
  </a>
</div>
<br>
<div class="text-center" id="asc-desc">
  <a class="btn btn-large">ORDER</a>
  <a class="btn btn-large btn-info" href="#asc">Ascending</a>
  <a class="btn btn-large btn-info" href="#desc">Descending</a>
</div>
<br>
<div id="container" class="text-center">
  {{#each this}}
  <div class="card text-center item pop {{#each cuisines}}{{this}} {{/each}}{{label}}">
    {{#if label}}
    <p class="lead name" style="color:orange;">{{name}}</p>
    {{else}}
    <p class="lead name">{{name}}</p>
    {{/if}}
    <p>{{#each cuisines}}{{this}}  {{/each}}</p>
  {{#if locations.hood}}
    <p class="hood">{{locations.hood}}</p>
  {{else}}
    <p class="city">{{locations.city}}</p>
  {{/if}}
    <div>
      <div class="blockery">
        <a class="text-center" href="{{yelp_url}}" target="_blank"><img class="yelp_link" src="{{image}}"/></a>
      </div>
      <div class="blockery">
        <p class="score_hover">Score: <strong style="color:orange;" class="score">{{score}}</strong></p>
        <p class="dist">{{distance}} min walk</p>
        <p class="last_visit">{{last_choice}}</p>
        <p class="last" style="display: none;">{{last_unix}}</p>
      {{#if list_check}}
        <p>On <strong style="color:orange;">{{lists}}</strong> lists</p>
      {{else}}
        <p>On <strong style="color:orange;">{{lists}}</strong> list</p>
      {{/if}}
{{!--         <p><a href="{{yelp_url}}" target="_blank"><img src="http://s3-media1.ak.yelpcdn.com/assets/2/www/img/55e2efe681ed/developers/yelp_logo_50x25.png"></a></p> --}}
      </div>
    </div>
    <span class="button-span" style="display: none;">
      <a class="btn btn-small btn-success go-button" href="/restaurants/{{id}}">Go</a>
      {{#if label}}
      <a class="btn btn-small btn-info unfav-button" href="/unfavorite?id={{id}}" data-method="post">Favorite</a>
      {{else}}
      <a class="btn btn-small btn-info fav-button" href="/favorite?id={{id}}" data-method="post">Favorite</a>
      {{/if}}
      <a class="btn btn-small btn-danger del-button" href="/lists/{{list_id}}" data-confirm="Are you sure?" data-method="delete">Delete</a>
    </span>
  </div>
  {{/each}}
</div>

<script>
  $(function(){
    var $container = $('#container');
    $('#container').isotope({
      // options
      itemSelector : '.item',
      layoutMode : 'fitRows',
      getSortData : {
        name : function ( $elem ) {
          return $elem.find('.name').text();
        },
        hood : function ( $elem ) {
          return $elem.find('.hood').text();
        },
        last : function ( $elem ) {
          return $elem.find('.last').text();
        },
        dist : function ( $elem ) {
          return parseInt($elem.find('.dist').text());
        },
        score : function ( $elem ) {
          return parseInt($elem.find('.score').text());
        }
      }
    });

    $('#sort-by a').click(function(){
      // get href attribute, minus the '#'
      var sortName = $(this).attr('href').slice(1);
      if(sortName == "score"){
        $('#container').isotope({ sortBy : sortName, sortAscending: false });
      } else{
        $('#container').isotope({ sortBy : sortName });
      }
      return false;
    });

    $('#filters #cuisine-button').click(function(){
      if($("#cuisine-show").is(":visible")){
        $(".cuisine-input").toggle();
        $("#cuisine-input").focus();
      }else{
        $(".cuisine-input").toggle();
      }
      return false;
    });

    $('#cuisine-filter input').keypress(function(e) {
      if(e.which == 13) {
        jQuery(this).blur();
        jQuery('#cuisine-submit').focus().click();
        return false;
      }
    });

    // $('#cuisine-filter input').autocomplete({

    // });

    $('#cuisine-submit').click(function(){
      $('#cuisine-filter input').submit();
      return false;
    });

    $('#cuisine-filter input').submit(function(event){
      event.preventDefault();
      var selector = $("#cuisine-input").val();
      selector = selector.charAt(0).toUpperCase() + selector.slice(1);
      if(selector == "Burger"){
        selector = "Burgers";
      }else if(selector == "Sandwich"){
        selector = "Sandwiches";
      }else if(selector == "Steakhouse"){
        selector = "Steakhouses";
      }else if(selector == "Hotdog"){
        selector = "Dogs";
      }else if(selector == "Desert"){
        selector = "Deserts";
      }
      $("#cuisine-show").html(selector);
      $container.isotope({ filter: "."+selector });
      $(".cuisine-input").toggle();
      return false;
    });

    $('#filters .filter-click').click(function(){
      var selector = $(this).attr('data-filter');
      $container.isotope({ filter: selector });
      return false;
    });

    $('#asc-desc a').click(function(){
      var order = $(this).attr('href').slice(1);
      if(order == "asc"){
        $('#container').isotope({ sortAscending: true });
      }else if(order == "desc"){
        $('#container').isotope({ sortAscending: false });
      }
      return false;
    });

    $('.item').hover(function(){
      $(this).find('.button-span').fadeIn();
    });
    $('.item').mouseleave(function(){
      $(this).find('.button-span').fadeOut();
    });

    $('.score_hover, #score_button').tooltip({
      title: "based on distance, last visit, favorite",
      placement: 'right',
      container: 'body'
    });
    $('.last_visit').tooltip({
      title: "last visit",
      placement: 'right',
      container: 'body'
    });
    $('.yelp_link').tooltip({
      title: "click to visit yelp page",
      placement: 'right',
      container: 'body'
    });
    $('.fav-button').tooltip({
      title: "click to make this restaurant a favorite",
      placement: 'bottom',
      container: 'body'
    });
    $('.unfav-button').tooltip({
      title: "click to undo favorite status",
      placement: 'bottom',
      container: 'body'
    });
    $('.del-button').tooltip({
      title: "click to remove this place from your list",
      placement: 'bottom',
      container: 'body'
    });
    $('.go-button').tooltip({
      title: "click to get directions and check for delivery",
      placement: 'bottom',
      container: 'body'
    });
  });
</script>
