</br>
</br>
</br>
<!-- <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script> -->

<script>
//   var directionsService = new google.maps.DirectionsService();
//   var start = new google.maps.LatLng(40.705961, -74.007953);
// </script>
<% if user_signed_in? && (current_user.restaurants.count > 0)%>
  <div id="myCarousel" class="carousel span8 offset2 pop">
    <!-- Carousel items -->
    <div class="carousel-inner">
      <% @ranked_list.reverse_each do |restaurant| %>
          <%# @walk = HTTParty.get("http://maps.googleapis.com/maps/api/directions/json?origin=40.705961,-74.007953&destination=#{restaurant.locations.last.latitude},#{restaurant.locations.last.longitude}&mode=walking&sensor=false") %>
          <%# @cab= HTTParty.get("http://maps.googleapis.com/maps/api/directions/json?origin=40.705961,-74.007953&destination=#{restaurant.locations.last.latitude},#{restaurant.locations.last.longitude}&sensor=false") %>
        <% if restaurant.choices.where(user_id: current_user.id).exists? %>
          <% if ((Time.now - restaurant.choices.where(user_id: current_user.id).last.created_at)/(24*60*60)).to_i > 5 %>
            <% time_score = 25 %>
          <% else %>
            <% time_score = 0 %>
          <% end %>
        <% else %>
          <% time_score = 25 %>
        <% end %>
        <% if restaurant.lists.find_by(user_id: current_user.id).label=="favorite" %>
          <% fav_score = 25 %>
        <% else %>
          <% fav_score = 0 %>
        <% end %>
        <% score = 50+fav_score+time_score %>
        <% if restaurant == @ranked_list[-1] %>
          <div class="item active text-center well" id="restaurant_<%= restaurant.id %>">
            <p class="lead"><%=restaurant.name%></p>
            <p><%=restaurant.cuisine%></p>
            <p><%=restaurant.locations.last.hood%></p>
            <div>
              <div class="blockery">
                <% if restaurant.image %>
                  <p class="text-center"><img src=<%=restaurant.image%>/></p>
                <% end %>
              </div>
              <div class="blockery">
                <p id="walk_<%= restaurant.id %>">
                  <%= (restaurant.locations.last.distance_to(request.location.coordinates)*20).to_i %> min walk
                </p>
                <p id="cab_<%= restaurant.id %>"><%= request.location.coordinates %></p>
                <p>Score: <strong style="color:orange;"><%=score%></strong></p>
                <p><a href="<%=restaurant.yelp_url%>" target="_blank"><img src="http://s3-media1.ak.yelpcdn.com/assets/2/www/img/55e2efe681ed/developers/yelp_logo_50x25.png"></a></p>
              </div>
            </div>
            <br>
            <br>
            <div class="text-center">
              <%= button_to('Go', restaurant_path(restaurant), :class => 'btn btn-default btn-primary btn-large') %>
            </div>
          </div>

        <% else %>
          <div class="item text-center well">
            <p class="lead"><%=restaurant.name%></p>
            <p><%=restaurant.cuisine%></p>
            <p><%=restaurant.locations.last.hood%></p>
            <div>
              <div class="blockery">
                <% if restaurant.image %>
                  <p class="text-center"><img src=<%=restaurant.image%>/></p>
                <% end %>
              </div>
              <div class="blockery">
                <p id="walk_<%= restaurant.id %>">
                  <%= (restaurant.locations.last.distance_to(request.location.coordinates)*20).to_i %> min walk
                </p>
                <p id="cab_<%= restaurant.id %>"></p>
                <p>Score: <strong style="color:orange;"><%=score%></strong></p>
                <p><a href="<%=restaurant.yelp_url%>" target="_blank"><img src="http://s3-media1.ak.yelpcdn.com/assets/2/www/img/55e2efe681ed/developers/yelp_logo_50x25.png"></a></p>
              </div>
            </div>
            </br>
            </br>
            <div class="text-center">
              <%= button_to('Go', restaurant_path(restaurant), :class => 'btn btn-default btn-primary btn-large') %>
            </div>
          </div>

        <% end %>


      <% end %>
    </div>
    <!-- Carousel nav -->
    <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
    <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>

  </div>

  <% @ranked_list.reverse_each do |restaurant| %>

   <script>
    $('#walk_<%= restaurant.id %>').html("google fail")

//      $(function () {

//         var end = new google.maps.LatLng(<%= restaurant.locations.last.latitude %>, <%= restaurant.locations.last.longitude %>);

//         var cab_request = {
//           origin:start,
//           destination:end,
//           travelMode: google.maps.TravelMode.DRIVING
//         };

//         var transit_request = {
//           origin:start,
//           destination:end,
//           travelMode: google.maps.TravelMode.DRIVING
//         };

//         var walk_request = {
//           origin:start,
//           destination:end,
//           travelMode: google.maps.TravelMode.WALKING
//         };

//         directionsService.route(cab_request, function(result, status) {
//           if (status == google.maps.DirectionsStatus.OK) {
//             duration = result["routes"][0]["legs"][0]["duration"]["text"];
//             $('#cab_<%= restaurant.id %>').html(duration + " cab");
//           }
//         });

//         directionsService.route(walk_request, function(result, status) {
//           if (status == google.maps.DirectionsStatus.OK) {
//             duration = result["routes"][0]["legs"][0]["duration"]["text"];
//             $('#walk_<%= restaurant.id %>').html(duration + " walk");
//           } else if (status == google.maps.DirectionsStatus.OVER_QUERY_LIMIT) {
//             $('#walk_<%= restaurant.id %>').html("google fail");
//           }
//         });

//       });
<% end %>
<% end %>


